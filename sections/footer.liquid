<div class="footer_main-wrapper">
  <div id="w-node-_5eccf730-c887-5204-0e0c-693f99a73293-99a7328f" class="footer_link-grid">
    {% for link in linklists[section.settings.menu].links %}
      <div class="footer_link-column">
        <div class="titre-footer">{{ link.title }}</div>
        {% if link.links.size > 0 %}
          <div class="footer_link-list">
            {% for child_link in link.links %}
              <a href="{{ child_link.url }}" class="footer_link">{{ child_link.title }}</a>
            {% endfor %}
          </div>
        {% endif %}
      </div>
    {% endfor %}
  </div>
</div>

<!-- Section logo et informations en pleine largeur en dessous -->
<div class="footer_sub-footer">
  <a href="{{ routes.root_url }}" class="footer_logo-link w-inline-block">
    {% if section.settings.image_logo %}
      {{ section.settings.image_logo | image_url: width: 1000 | image_tag: loading: 'lazy', width: '182', class: 'footer_logo' }}
    {% else %}
      <img src="{{ 'Faroush-light-yellow.svg' | asset_url }}" loading="lazy" width="182" alt="" class="footer_logo">
    {% endif %}
  </a>
  
  {% if shop.enabled_payment_types.size > 0 %}
    <div class="footer_icon-block">
      <div class="text-size-regular footer">
        {{ section.settings.text_payment_method }}
      </div>
      <ul role="list" class="footer_payment-list w-list-unstyled">
        {% for type in shop.enabled_payment_types %}
          <li class="footer_payment-item">
            <div class="footer_payment-svg">
              {{ type | payment_type_svg_tag: class: 'footer_payment-img icon--full-color' }}
            </div>
          </li>
        {% endfor %}
      </ul>
    </div>
  {% endif %}

  {%- comment -%}
    Affiche les switchers si : au moins 1 langue OU au moins 1 pays (toujours vrai),
    afin que le bouton devise soit toujours visible.
  {%- endcomment -%}
  {% if localization.available_languages.size > 1 or localization.available_countries.size > 0 %}
    <div class="li-lang_wrapper">

      {%- if localization.available_languages.size > 1 -%}
        <localization-form class="li-lang_form-container">
          {% form 'localization', class: 'li-lang_form' %}
            <div data-hover="true" data-delay="500" class="li-lang_dropdown w-dropdown">
              <div lang="{{ localization.language.iso_code }}" class="li-lang_dd-toggle w-dropdown-toggle">
                <div>{{ localization.language.endonym_name | capitalize }}</div>
                <div class="li-lang_dd-toggle-icon w-embed">
                  <svg width="100%" height="100%" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path clip-rule="evenodd" d="M2.55806 6.29544C2.46043 6.19781 2.46043 6.03952 2.55806 5.94189L3.44195 5.058C3.53958 4.96037 3.69787 4.96037 3.7955 5.058L8.00001 9.26251L12.2045 5.058C12.3021 4.96037 12.4604 4.96037 12.5581 5.058L13.4419 5.94189C13.5396 6.03952 13.5396 6.19781 13.4419 6.29544L8.17678 11.5606C8.07915 11.6582 7.92086 11.6582 7.82323 11.5606L2.55806 6.29544Z" fill="currentColor"></path>
                  </svg>
                </div>
              </div>
              <nav class="li-lang_dd-list w-dropdown-list">
                {% for language in localization.available_languages %}
                  {% unless localization.language.iso_code == language.iso_code %}
                    <div class="li-lang_dd-list-item">
                      <a href="#" lang="{{ language.iso_code }}" hreflang="{{ language.iso_code }}" data-value="{{ language.iso_code }}" class="li-lang_dd-link w-dropdown-link">
                        {{ language.endonym_name | capitalize }}
                      </a>
                    </div>
                  {% endunless %}
                {% endfor %}
              </nav>
            </div>
            <input type="hidden" name="language_code" class="li-lang_hidden-input" value="{{ localization.language.iso_code }}">
          {% endform %}
        </localization-form>
      {%- endif -%}

      {%- comment -%}
        Sélecteur devise robuste :
        - current_currency = localization.currency OU fallback localization.country.currency
        - options = available_currencies SINON dédupliquées depuis available_countries
      {%- endcomment -%}
      <localization-form class="li-currency_form-container">
        {% form 'localization', class: 'li-currency_form' %}

          {%- assign current_currency = localization.currency -%}
          {%- if current_currency == nil or current_currency.iso_code == blank -%}
            {%- assign current_currency = localization.country.currency -%}
          {%- endif -%}

          {%- assign currencies_count = localization.available_currencies | size -%}

          <div data-hover="true" data-delay="500" class="li-currency_dropdown w-dropdown" {% if currencies_count <= 1 %}data-disabled="true"{% endif %}>
            <div class="li-currency_dd-toggle w-dropdown-toggle">
              <div>{{ current_currency.iso_code }} {{ current_currency.symbol }}</div>
              <div class="li-currency_dd-toggle-icon w-embed">
                <svg width="100%" height="100%" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path clip-rule="evenodd" d="M2.55806 6.29544C2.46043 6.19781 2.46043 6.03952 2.55806 5.94189L3.44195 5.058C3.53958 4.96037 3.69787 4.96037 3.7955 5.058L8 9.2625 12.2045 5.058c.0976-.0976.2559-.0976.3535 0l.8839.8839c.0977.0976.0977.2559 0 .3535L8.1768 11.5606c-.0977.0976-.256.0976-.3536 0L2.5581 6.29544Z" fill="currentColor"/>
                </svg>
              </div>
            </div>

            {%- if currencies_count > 1 -%}
              <nav class="li-currency_dd-list w-dropdown-list">
                {% for currency in localization.available_currencies %}
                  {% unless current_currency.iso_code == currency.iso_code %}
                    <div class="li-currency_dd-list-item">
                      <a href="#" data-value="{{ currency.iso_code }}" class="li-currency_dd-link w-dropdown-link">
                        {{ currency.iso_code }} {{ currency.symbol }}
                      </a>
                    </div>
                  {% endunless %}
                {% endfor %}
              </nav>
            {%- else -%}
              {%- comment -%} Fallback : déduplique via les pays {%- endcomment -%}
              <nav class="li-currency_dd-list w-dropdown-list">
                {% assign seen = '' %}
                {% for country in localization.available_countries %}
                  {% unless seen contains country.currency.iso_code %}
                    {% unless current_currency.iso_code == country.currency.iso_code %}
                      <div class="li-currency_dd-list-item">
                        <a href="#" data-value="{{ country.currency.iso_code }}" class="li-currency_dd-link w-dropdown-link">
                          {{ country.currency.iso_code }} {{ country.currency.symbol }}
                        </a>
                      </div>
                    {% endunless %}
                    {% capture seen %}{{ seen }}|{{ country.currency.iso_code }}{% endcapture %}
                  {% endunless %}
                {% endfor %}
              </nav>
            {%- endif -%}
          </div>

          <input type="hidden" name="currency_code" class="li-currency_hidden-input" value="{{ current_currency.iso_code }}">
        {% endform %}
      </localization-form>

      <div class="li-lang_script w-embed w-script">
        <script>
          class LocalizationForm extends HTMLElement {
            constructor() {
              super();
              this.input = this.querySelector('input[name="language_code"], input[name="currency_code"]');
              this.querySelectorAll('a').forEach(item =>
                item.addEventListener('click', this.onItemClick.bind(this))
              );
            }
            onItemClick(event) {
              event.preventDefault();
              const form = this.querySelector('form');
              this.input.value = event.currentTarget.dataset.value;
              if (form) form.submit();
            }
          }
          customElements.define('localization-form', LocalizationForm);
        </script>
      </div>
    </div>
  {% endif %}
</div>

{% schema %}
{
  "tag": "footer",
  "name": "footer",
  "class": "section_footer",
  "settings": [
    { "id": "image_logo", "type": "image_picker", "label": "Logo" },
    { "id": "text_payment_method", "type": "text", "label": "Payment Method", "default": "Payment Method" },
    { "type": "header", "content": "Navigation" },
    { "type": "link_list", "id": "menu", "label": "Footer Menu", "default": "footer" }
  ],
  "presets": [{ "name": "footer", "category": "Liquify", "blocks": [] }],
  "enabled_on": { "groups": ["*"] }
}
{% endschema %}

<style>
.section_footer { padding: 20px; font-family: 'Karla', sans-serif; color: #f5f2d9; }
.footer_main-wrapper { margin-bottom: 50px; }
.footer_link-grid { display: flex; justify-content: space-between; width: 100%; }

/* Titres principaux (parents) */
.titre-footer { font-family: 'Karla', sans-serif; font-weight: bold; text-transform: uppercase; color: #f5f2d9; }

/* Liens enfants */
.footer_link { font-family: 'Karla', sans-serif; font-weight: 500; color: #f5f2d9; text-decoration: none; }

/* Effet hover sur desktop pour les child-links */
@media (min-width: 768px) {
  .footer_link:hover { opacity: 0.7; }
}

/* Footer sub-footer */
.footer_sub-footer, .footer_sub-footer * { font-family: 'Karla', sans-serif; color: #f5f2d9; }
.text-size-regular.footer { font-family: 'Karla', sans-serif; color: #f5f2d9; }

/* Desktop : espacement des switchers */
@media (min-width: 768px) {
  .footer_sub-footer { display: flex; align-items: center; gap: 20px; }
}

/* Switchers - FOOTER UNIQUEMENT */
.li-lang_wrapper { display: flex !important; gap: 15px !important; align-items: center !important; }
.li-lang_form-container, .li-currency_form-container { position: relative !important; }
.li-lang_dropdown, .li-currency_dropdown { font-family: 'Karla', sans-serif !important; color: #f5f2d9 !important; }

/* Boutons outline */
.footer_sub-footer .li-lang_dd-toggle, .footer_sub-footer .li-currency_dd-toggle {
  font-family: 'Karla', sans-serif !important; color: #f5f2d9 !important;
  display: flex !important; align-items: center !important; gap: 8px !important;
  cursor: pointer !important; border: 1px solid #f5f2d9 !important;
  border-radius: 10px !important; padding: 8px 12px !important;
  background: transparent !important; box-sizing: border-box !important;
}

.li-lang_dd-toggle-icon, .li-currency_dd-toggle-icon {
  width: 12px !important; height: 12px !important; flex-shrink: 0 !important;
  display: flex !important; align-items: center !important; justify-content: center !important;
  transition: transform 0.2s ease !important;
}

.w-dropdown.w--open .li-currency_dd-toggle-icon { transform: rotate(180deg) !important; }

/* Dropdown clair */
.footer_sub-footer .li-lang_dd-list, .footer_sub-footer .li-currency_dd-list {
  font-family: 'Karla', sans-serif !important; position: absolute !important;
  bottom: 100% !important; left: 0 !important; margin-bottom: 5px !important;
  background: #f5f2d9 !important; border-radius: 10px !important; min-width: 120px !important;
  z-index: 100 !important; border: 1px solid #f5f2d9 !important; box-shadow: 0 4px 8px rgba(0,0,0,0.2) !important;
}

/* Liens dropdown foncés */
.footer_sub-footer .li-lang_dd-link, .footer_sub-footer .li-currency_dd-link {
  font-family: 'Karla', sans-serif !important; color: #6e612b !important;
  text-decoration: none !important; padding: 8px 12px !important; display: block !important;
}
.footer_sub-footer .li-lang_dd-link:hover, .footer_sub-footer .li-currency_dd-link:hover {
  background: rgba(110,97,43,0.1) !important; color: #6e612b !important;
}

/* Apparence "muette" quand une seule devise */
.li-currency_dropdown[data-disabled="true"] .li-currency_dd-toggle { cursor: default !important; }

@media (max-width: 767px) {
  .section_footer { padding: 20px 10px; }
  .footer_main-wrapper { margin-bottom: 20px; }
  .footer_link-grid { flex-direction: column; gap: 20px; }
}
</style>
