<style>
  .section-sticky-add-to-cart {
    position: fixed;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 9999;
    background-color: #f5f2d9;
    padding: 15px 20px 20px;
    border-top: 1px solid rgba(110, 97, 43, 0.2);
    box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
    transform: translateY(100%);
    transition: transform 0.3s ease-in-out;
    display: none;
  }
  
  /* Affichage uniquement sur tablet et mobile */
  @media screen and (max-width: 991px) {
    .section-sticky-add-to-cart {
      display: block;
    }
  }
  
  .section-sticky-add-to-cart.is-visible {
    transform: translateY(0);
  }
  
  .sticky-cart-container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 15px;
    max-width: 100%;
  }
  
  .sticky-cart-product-info {
    display: flex;
    align-items: center;
    gap: 12px;
    flex: 1;
    min-width: 0;
  }
  
  .sticky-cart-product-image {
    width: 50px;
    height: 50px;
    border-radius: 8px;
    object-fit: cover;
    background-color: #fff;
  }
  
  .sticky-cart-product-details {
    flex: 1;
    min-width: 0;
  }
  

  
  .sticky-cart-product-price {
    font-family: Karla, sans-serif;
    font-size: 16px;
    font-weight: 700;
    color: #6e612b;
    margin: 0;
  }
  
  .sticky-cart-actions {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  
  .sticky-cart-select {
    min-width: 80px;
    padding: 8px 12px;
    border: 1px solid #6e612b;
    border-radius: 8px;
    background-color: transparent;
    font-family: Karla, sans-serif;
    font-size: 14px;
    font-weight: 600;
    color: #6e612b;
    text-align: center;
  }
  
  .sticky-cart-add-button {
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    background-color: hsla(19.74193548387097, 80.31%, 62.16%, 1.00);
    font-family: Karla, sans-serif;
    font-size: 14px;
    font-weight: 600;
    color: #f5f2d9;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s ease;
    white-space: nowrap;
    min-width: 120px;
  }
  
  .sticky-cart-add-button:hover {
    background-color: hsla(19.74193548387097, 80.31%, 55%, 1.00);
  }
  
  .sticky-cart-add-button:disabled {
    background-color: #ccc;
    cursor: not-allowed;
  }
  
  .sticky-cart-out-of-stock {
    padding: 12px 24px;
    border: 1px solid #6e612b;
    border-radius: 8px;
    background-color: transparent;
    font-family: Karla, sans-serif;
    font-size: 14px;
    font-weight: 600;
    color: #6e612b;
    text-align: center;
    min-width: 120px;
  }
  
  /* Responsive mobile */
  @media screen and (max-width: 479px) {
    .section-sticky-add-to-cart {
      padding: 12px 15px 15px;
    }
    
    .sticky-cart-container {
      gap: 10px;
    }
    
    .sticky-cart-product-image {
      width: 40px;
      height: 40px;
    }
    
    .sticky-cart-product-price {
      font-size: 15px;
    }
    
    .sticky-cart-select {
      min-width: 70px;
      padding: 6px 8px;
      font-size: 13px;
    }
    
    .sticky-cart-add-button,
    .sticky-cart-out-of-stock {
      padding: 10px 18px;
      font-size: 13px;
      min-width: 100px;
    }
  }
</style>

<div class="section-sticky-add-to-cart" id="sticky-add-to-cart">
  <div class="sticky-cart-container">
    <!-- Informations produit -->
    <div class="sticky-cart-product-info">
      {% if product.featured_image %}
        <img 
          class="sticky-cart-product-image" 
          src="{{ product.featured_image | image_url: width: 100 }}"
          alt="{{ product.title | escape }}"
          loading="lazy"
        />
      {% endif %}
      <div class="sticky-cart-product-details">
        <p class="sticky-cart-product-price">
          {% if product.price_varies %}
            À partir de {{ product.price_min | money }}
          {% else %}
            {{ product.price | money }}
          {% endif %}
        </p>
      </div>
    </div>
    
    <!-- Actions -->
    <div class="sticky-cart-actions">
      <!-- Sélecteur de variantes si nécessaire -->
      {% if product.variants.size > 1 and product.has_only_default_variant == false %}
        <select class="sticky-cart-select" id="sticky-variant-selector">
          {% for variant in product.variants %}
            <option value="{{ variant.id }}" {% if variant.available == false %}disabled{% endif %}>
              {{ variant.title }}
            </option>
          {% endfor %}
        </select>
      {% endif %}
      
      <!-- Bouton d'ajout -->
      {% if product.available %}
        <button 
          class="sticky-cart-add-button"
          onclick="addToCartSticky()"
          id="sticky-add-button"
        >
          Ajouter au panier
        </button>
      {% else %}
        <div class="sticky-cart-out-of-stock">
          Épuisé
        </div>
      {% endif %}
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const stickyCart = document.getElementById('sticky-add-to-cart');
  const mainAddButton = document.querySelector('[li-element="add-to-cart"]') || document.querySelector('.add-to-cart-button');
  
  if (!stickyCart || !mainAddButton) return;
  
  // Gestion de l'apparition/disparition
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        stickyCart.classList.remove('is-visible');
      } else {
        stickyCart.classList.add('is-visible');
      }
    });
  }, {
    threshold: 0.1,
    rootMargin: '0px 0px -50px 0px'
  });
  
  observer.observe(mainAddButton);
  
  // Masquer dans le footer
  const footer = document.querySelector('footer');
  if (footer) {
    const footerObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          stickyCart.classList.remove('is-visible');
        }
      });
    }, { threshold: 0.1 });
    
    footerObserver.observe(footer);
  }
});

// Fonction d'ajout au panier
function addToCartSticky() {
  const variantSelector = document.getElementById('sticky-variant-selector');
  const variantId = variantSelector ? variantSelector.value : {{ product.selected_or_first_available_variant.id }};
  
  const formData = {
    'items': [{
      'id': variantId,
      'quantity': 1
    }]
  };
  
  fetch('/cart/add.js', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify(formData)
  })
  .then(response => response.json())
  .then(data => {
    // Déclencher l'événement d'ajout au panier (si tu as d'autres scripts qui l'écoutent)
    window.dispatchEvent(new CustomEvent('cart:item-added', { detail: data }));
    
    // Feedback visuel
    const button = document.getElementById('sticky-add-button');
    if (button) {
      const originalText = button.textContent;
      button.textContent = 'Ajouté !';
      button.disabled = true;
      setTimeout(() => {
        button.textContent = originalText;
        button.disabled = false;
      }, 2000);
    }
  })
  .catch((error) => {
    console.error('Erreur:', error);
  });
}
</script>

{% schema %}
{
  "name": "Sticky Add to Cart"
}
{% endschema %}
